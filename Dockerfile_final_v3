FROM runpod/pytorch:2.4.0-py3.11-cuda12.4.1-devel-ubuntu22.04

# Systempakete & Python vorbereiten
RUN apt-get update && apt-get install -y git wget curl ffmpeg libgl1 libglib2.0-0 && \
    pip install --upgrade pip

# ComfyUI klonen
WORKDIR /workspace
RUN git clone https://github.com/comfyanonymous/ComfyUI.git /workspace/ComfyUI

# ComfyUI Requirements installieren
RUN pip install -r /workspace/ComfyUI/requirements.txt

# Torchvision (kompatibel mit Torch 2.3.0)
RUN pip install torchvision==0.15.2

# xFormers (vorgefertigte stabile Version für Torch 2.3.0 + cu118)
RUN pip install --no-cache-dir xformers==0.0.26.post1 --extra-index-url https://download.pytorch.org/whl/cu118

# JupyterLab
RUN pip install jupyterlab

# Ports für ComfyUI (8188) + Jupyter (8888)
EXPOSE 8188
EXPOSE 8888

# Start ComfyUI per Default (Jupyter manuell bei Bedarf)
CMD ["python3", "/workspace/ComfyUI/main.py", "--listen", "--port", "8188", "--output-directory", "/workspace/output", "--input-directory", "/workspace/input"]
